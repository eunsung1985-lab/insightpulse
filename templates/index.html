{% extends "base.html" %}

{% block content %}
<div class="flex flex-col md:flex-row gap-8">
    <!-- Sidebar (Keywords) -->
    <div class="w-full md:w-64 flex-shrink-0">
        <div class="glass-panel p-4 rounded-xl sticky top-24">
            <h3 class="font-bold text-slate-800 mb-4 flex justify-between items-center">
                <span>â­ ê´€ì‹¬ í‚¤ì›Œë“œ</span>
                <span class="text-xs text-slate-400">ìµœê·¼ 3ì¼ ë‰´ìŠ¤</span>
            </h3>

            <!-- Default option -->
            <a href="/"
                class="block px-3 py-2 rounded-lg mb-1 transition-colors {{ 'bg-indigo-100 text-indigo-700 font-semibold' if current_keyword == 'ì „ì²´' else 'text-slate-600 hover:bg-slate-50' }}">
                ğŸ“‘ ì „ì²´ ë³´ê¸°
            </a>

            <!-- User Keywords -->
            <div id="keyword-list">
                {% for kw in keywords %}
                <div
                    class="group flex items-center justify-between px-3 py-2 rounded-lg mb-1 transition-colors {{ 'bg-indigo-100 text-indigo-700 font-semibold' if current_keyword == kw else 'text-slate-600 hover:bg-slate-50' }}">
                    <a href="/?keyword={{ kw }}" class="flex-grow">{{ kw }}</a>
                    <button onclick="removeKeyword('{{ kw }}')"
                        class="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 px-1">
                        &times;
                    </button>
                </div>
                {% endfor %}
            </div>

            <!-- Add Keyword Input -->
            <div class="mt-4 pt-4 border-t border-slate-200">
                <div class="flex gap-2">
                    <input type="text" id="new-keyword" placeholder="í‚¤ì›Œë“œ ì¶”ê°€"
                        onkeypress="if(event.key === 'Enter') addKeyword()"
                        class="w-full px-3 py-1.5 text-sm rounded-md border border-slate-200 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                    <button onclick="addKeyword()"
                        class="bg-indigo-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-indigo-700">
                        +
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Feed -->
    <div class="flex-grow">
        <div class="mb-6">
            <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600">
                {{ current_keyword }} ê´€ë ¨ ë‰´ìŠ¤
            </h1>
            <p class="text-sm text-slate-500">ì‹œì„¸ ë‹¨ìˆœ ë³€ë™ ì •ë³´ë¥¼ ì œì™¸í•œ í•µì‹¬ ë‰´ìŠ¤ë§Œ ëª¨ì•˜ìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="grid gap-6">
            {% if news_items %}
            {% for item in news_items %}
            <div class="glass-panel p-6 rounded-2xl hover:shadow-xl transition-shadow">
                <div class="flex justify-between items-start mb-2">
                    <!-- Mock Sentiment Badge -->
                    <span class="bg-slate-100 text-slate-600 text-xs font-semibold px-2.5 py-0.5 rounded">{{
                        item.pub_date[:16] }}</span>
                    <!-- Link Analysis Button -->
                    <a href="/analysis?link={{ item.link }}"
                        class="text-indigo-600 text-xs font-semibold hover:underline">
                        ğŸ¤– AI ì‹¬ì¸µ ë¶„ì„
                    </a>
                </div>
                <a href="{{ item.link }}" target="_blank" class="block group">
                    <h3 class="text-lg font-bold mb-2 text-slate-800 group-hover:text-indigo-600 transition-colors">
                        {{ item.title }}
                    </h3>
                    <p class="text-slate-600 text-sm line-clamp-2">
                        {{ item.impact }}
                    </p>
                </a>
            </div>
            {% endfor %}
            {% else %}
            <div class="text-center py-12 text-slate-500">
                <p>ìµœê·¼ 3ì¼ê°„ ê´€ë ¨ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <p class="text-sm mt-2">í‚¤ì›Œë“œë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    async function addKeyword() {
        const input = document.getElementById('new-keyword');
        const keyword = input.value.trim();
        if (!keyword) return;

        await fetch('/api/keywords', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ keyword: keyword })
        });
        location.reload();
    }

    async function removeKeyword(keyword) {
        if (!confirm(`'${keyword}' í‚¤ì›Œë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        await fetch('/api/keywords', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ keyword: keyword })
        });
        location.reload();
    }
</script>
{% endblock %}